mos re-implementation goes from here.
